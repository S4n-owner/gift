<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>LifeOS â€“ Trung tÃ¢m tÃ i sáº£n</title>

<style>
:root{
  --bg:#0b0f14;--card:#121821;--text:#e8ecf1;
  --accent:#00ff99;--danger:#ff4d4d;--border:#1f2a38;
}
body{margin:0;font-family:Segoe UI;background:var(--bg);color:var(--text)}
a{color:var(--accent);text-decoration:none;margin:12px;display:inline-block}
.section{background:var(--card);padding:16px;border-radius:14px;margin:16px;border:1px solid var(--border)}
.total{font-size:26px;font-weight:bold;color:var(--accent)}
input{width:100%;padding:10px;border-radius:8px;background:#0b0f14;color:white;border:1px solid var(--border)}
button{margin-top:8px;padding:8px 12px;border:none;border-radius:8px;background:var(--accent);font-weight:bold;cursor:pointer}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}
.asset-card{background:#0b0f14;padding:12px;border-radius:10px;border:1px solid var(--border)}
.asset-card b{display:block;margin-top:6px;color:var(--accent)}
.item{display:grid;grid-template-columns:1fr 120px 40px;gap:8px;margin-top:8px}
.up{color:var(--accent)} .down{color:var(--danger)}
.warn{color:var(--danger);font-weight:bold;margin-top:6px}
</style>
</head>

<body>

<a href="finance.html">â† Quáº£n lÃ½ chi tiÃªu</a>

<div class="section">
<h2>ğŸ”„ Biáº¿n Ä‘á»™ng tÃ i sáº£n</h2>
<div>TrÆ°á»›c: <b id="beforeTotal">0 Ä‘</b></div>
<input type="number" id="changeMoney">
<div>Biáº¿n Ä‘á»™ng: <b id="diff">0 Ä‘</b></div>
<div>Sau: <span id="afterTotal" class="total">0 Ä‘</span></div>
<button onclick="applyChange()">Ãp dá»¥ng</button>
</div>

<div class="section">
<h2>ğŸ’° Tá»•ng tÃ i sáº£n</h2>
<div id="totalAsset" class="total">0 Ä‘</div>
</div>

<div class="section">
<h2>ğŸ“Š PhÃ¢n bá»• chiáº¿n lÆ°á»£c</h2>
<div>60% PhÃ¡t triá»ƒn báº£n thÃ¢n: <b id="fund60">0 Ä‘</b></div>
<div>40% Äáº§u tÆ° & tiáº¿t kiá»‡m: <b id="fund40">0 Ä‘</b></div>
</div>

<div class="section">
<h2>ğŸ“ PhÃ¡t triá»ƒn báº£n thÃ¢n</h2>
<div id="selfList"></div>
<button onclick="addSelfItem()">â• ThÃªm</button>
<div>
  Tá»•ng: <b id="selfTotal">0 Ä‘</b> / Quá»¹ 60%: <b id="selfLimit">0 Ä‘</b>
  <div id="selfWarn"></div>
</div>
</div>

<div class="section">
<h2>ğŸ“ˆ Tá»•ng quá»¹ Ä‘áº§u tÆ°</h2>
<div id="investTotal" class="total">0 Ä‘</div>
</div>

<div class="section">
<h2>ğŸ§© Danh má»¥c Ä‘áº§u tÆ°</h2>
<div class="grid">
  <div class="asset-card">ğŸš¨ Quá»¹ kháº©n cáº¥p<b id="emergency"></b></div>
  <div class="asset-card">ğŸ“Š ETF<b id="etf"></b></div>
  <div class="asset-card">ğŸ¢ Cá»• phiáº¿u<b id="stock"></b></div>
  <div class="asset-card">ğŸ›ï¸ Bluechip<b id="bluechip"></b></div>
  <div class="asset-card">âš¡ Crypto<b id="crypto"></b></div>
  <div class="asset-card">ğŸ¥‡ VÃ ng<b id="gold"></b></div>
</div>
</div>

<div class="section">
<h2>ğŸŒ³ CÃ¢y danh má»¥c chi tiáº¿t</h2>

<div id="trees"></div>
</div>

<script>
const f = n => Number(n||0).toLocaleString("vi-VN")+" Ä‘";

let total = Number(localStorage.getItem("lifeos_total")) || 0;
let selfItems = JSON.parse(localStorage.getItem("lifeos_self")) || [];

let subAssets = JSON.parse(localStorage.getItem("lifeos_sub")) || {
  emergency:[], etf:[], stock:[], bluechip:[], crypto:[], gold:[]
};

const keys = ["emergency","etf","stock","bluechip","crypto","gold"];
const labels = {
  emergency:"ğŸš¨ Quá»¹ kháº©n cáº¥p", etf:"ğŸ“Š ETF", stock:"ğŸ¢ Cá»• phiáº¿u",
  bluechip:"ğŸ›ï¸ Bluechip", crypto:"âš¡ Crypto", gold:"ğŸ¥‡ VÃ ng"
};

/* ===== BIáº¾N Äá»˜NG ===== */

changeMoney.oninput = ()=>{
  const c = Number(changeMoney.value||0);
  beforeTotal.innerText = f(total);
  diff.innerText = (c>=0?"+":"")+f(c);
  diff.className = c>=0?"up":"down";
  afterTotal.innerText = f(total+c);
};

function applyChange(){
  total += Number(changeMoney.value||0);
  localStorage.setItem("lifeos_total", total);
  changeMoney.value="";
  renderWealth();
}

/* ===== SELF ===== */

function saveSelf(){ localStorage.setItem("lifeos_self",JSON.stringify(selfItems)); }

function addSelfItem(){
  selfItems.push({name:"",money:""});
  saveSelf(); renderSelf();
}

function renderSelf(){
  selfList.innerHTML="";
  selfItems.forEach((it,i)=>{
    selfList.innerHTML+=`
    <div class="item">
      <input value="${it.name}" oninput="selfItems[${i}].name=this.value;saveSelf()">
      <input type="number" value="${it.money}" oninput="selfItems[${i}].money=this.value;saveSelf();renderWealth()">
      <button onclick="selfItems.splice(${i},1);saveSelf();renderSelf()">âœ•</button>
    </div>`;
  });
}

/* ===== SUB TREE ===== */

function saveSub(){ localStorage.setItem("lifeos_sub",JSON.stringify(subAssets)); }

function sumSub(key){
  return subAssets[key].reduce((s,i)=>s+Number(i.money||0),0);
}

function renderTrees(){
  trees.innerHTML="";
  keys.forEach(k=>{
    trees.innerHTML+=`
      <h3>${labels[k]}</h3>
      <div id="${k}List"></div>
      <button onclick="addSub('${k}')">â• ThÃªm</button>
      <div id="${k}Warn"></div>`;
    renderSub(k);
  });
}

function addSub(key){
  subAssets[key].push({name:"",money:""});
  saveSub(); renderSub(key);
}

function renderSub(key){
  const box=document.getElementById(key+"List");
  box.innerHTML="";
  subAssets[key].forEach((it,i)=>{
    box.innerHTML+=`
    <div class="item">
      <input value="${it.name}" oninput="subAssets['${key}'][${i}].name=this.value;saveSub()">
      <input type="number" value="${it.money}" oninput="subAssets['${key}'][${i}].money=this.value;saveSub();renderWealth()">
      <button onclick="subAssets['${key}'].splice(${i},1);saveSub();renderSub('${key}');renderWealth()">âœ•</button>
    </div>`;
  });
}

/* ===== CORE DUY NHáº¤T ===== */

function renderWealth(){

  totalAsset.innerText = f(total);
  beforeTotal.innerText = f(total);
  afterTotal.innerText = f(total);

  const fund60v = total*0.6;
  const fund40v = total*0.4;

  fund60.innerText=f(fund60v);
  fund40.innerText=f(fund40v);
  selfLimit.innerText=f(fund60v);

  const selfSum=selfItems.reduce((s,i)=>s+Number(i.money||0),0);
  selfTotal.innerText=f(selfSum);
  selfWarn.innerText = selfSum>fund60v ? "âš ï¸ VÆ°á»£t "+f(selfSum-fund60v) : "";

  const invest = total*0.64;
  investTotal.innerText=f(invest);

  const limits={
    emergency:invest*0.20, etf:invest*0.20, stock:invest*0.15,
    bluechip:invest*0.20, crypto:invest*0.10, gold:invest*0.15
  };

  for(let k of keys){

    const used = sumSub(k);     // TIá»€N THáº¬T Tá»ª CÃ‚Y
    const limit = limits[k];   // Háº N Má»¨C CHIáº¾N LÆ¯á»¢C

    document.getElementById(k).innerText =
      f(used)+" / "+f(limit);

    document.getElementById(k+"Warn").innerText =
      used>limit ? "âš ï¸ VÆ°á»£t "+f(used-limit) : "";
  }
}

/* ===== INIT ===== */

renderSelf();
renderTrees();
renderWealth();
</script>

</body>
</html>
